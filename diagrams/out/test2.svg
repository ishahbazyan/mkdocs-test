<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1061px" preserveAspectRatio="none" style="width:1396px;height:1061px;background:#FFFFFF;" version="1.1" viewBox="0 0 1396 1061" width="1396px" zoomAndPan="magnify"><defs><filter height="300%" id="f3e7ztk4aag0g" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter><filter height="1" id="b3e7ztk4aag0g0" width="1" x="0" y="0"><feFlood flood-color="#FFD700" result="flood"/><feComposite in="SourceGraphic" in2="flood" operator="over"/></filter></defs><g><rect fill="#DDA0DD" height="1049.3203" style="stroke:#A80036;stroke-width:1.0;" width="273" x="311.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="410" y="18.0669">Кошелёк</text><rect fill="#ADD8E6" height="1049.3203" style="stroke:#A80036;stroke-width:1.0;" width="152" x="903" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66" x="943.5" y="18.0669">Партнёр</text><rect fill="#FFFFFF" filter="url(#f3e7ztk4aag0g)" height="381.3359" style="stroke:#000000;stroke-width:2.0;" width="822.5" x="409.5" y="367.7578"/><rect fill="#FFFFFF" filter="url(#f3e7ztk4aag0g)" height="194.7344" style="stroke:#000000;stroke-width:2.0;" width="651.5" x="419.5" y="436.1563"/><rect fill="#FFFFFF" height="148.4688" style="stroke:none;stroke-width:1.0;" width="651.5" x="419.5" y="482.4219"/><rect fill="#FFFFFF" filter="url(#f3e7ztk4aag0g)" height="90.5313" style="stroke:#000000;stroke-width:2.0;" width="631.5" x="429.5" y="533.3594"/><rect fill="#FFFFFF" height="111.2031" style="stroke:none;stroke-width:1.0;" width="822.5" x="409.5" y="637.8906"/><rect fill="#ADD8E6" filter="url(#f3e7ztk4aag0g)" height="188.9297" style="stroke:#000000;stroke-width:2.0;" width="341" x="897" y="763.0938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="61" x2="61" y1="88.2969" y2="969.0234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="372.5" x2="372.5" y1="88.2969" y2="969.0234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="509.5" x2="509.5" y1="88.2969" y2="969.0234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="979" x2="979" y1="88.2969" y2="969.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="5" y="84.9951">Пользователь</text><ellipse cx="61.5" cy="15" fill="#FEFECE" filter="url(#f3e7ztk4aag0g)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M61.5,23 L61.5,50 M48.5,31 L74.5,31 M61.5,50 L48.5,65 M61.5,50 L74.5,65 " fill="none" filter="url(#f3e7ztk4aag0g)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="5" y="981.0186">Пользователь</text><ellipse cx="61.5" cy="994.3203" fill="#FEFECE" filter="url(#f3e7ztk4aag0g)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M61.5,1002.3203 L61.5,1029.3203 M48.5,1010.3203 L74.5,1010.3203 M61.5,1029.3203 L48.5,1044.3203 M61.5,1029.3203 L74.5,1044.3203 " fill="none" filter="url(#f3e7ztk4aag0g)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f3e7ztk4aag0g)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="110" x="315.5" y="36.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="322.5" y="56.6982">Приложение</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="337" y="72.9951">Кошелёк</text><rect fill="#FEFECE" filter="url(#f3e7ztk4aag0g)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="110" x="315.5" y="968.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="322.5" y="988.0186">Приложение</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="337" y="1004.3154">Кошелёк</text><rect fill="#FEFECE" filter="url(#f3e7ztk4aag0g)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="137" x="439.5" y="36.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="479.5" y="56.6982">Сервер</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="446.5" y="72.9951">Кошелёк Pay API</text><rect fill="#FEFECE" filter="url(#f3e7ztk4aag0g)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="137" x="439.5" y="968.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="479.5" y="988.0186">Сервер</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="446.5" y="1004.3154">Кошелёк Pay API</text><rect fill="#FEFECE" filter="url(#f3e7ztk4aag0g)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="140" x="907" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="914" y="72.9951">Касса и ЦОД ТСП</text><rect fill="#FEFECE" filter="url(#f3e7ztk4aag0g)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="140" x="907" y="968.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="914" y="988.0186">Касса и ЦОД ТСП</text><polygon fill="#A80036" points="967,115.4297,977,119.4297,967,123.4297,971,119.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="61.5" x2="973" y1="119.4297" y2="119.4297"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="68.5" y="114.3638">[01]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="103.5" y="114.3638">Выкладка товаров к покупке</text><polygon fill="#A80036" points="360.5,144.5625,370.5,148.5625,360.5,152.5625,364.5,148.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="61.5" x2="366.5" y1="148.5625" y2="148.5625"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="68.5" y="143.4966">[02]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="103.5" y="143.4966">Выбор карты лояльности в Кошельке</text><polygon fill="#A80036" points="967,173.6953,977,177.6953,967,181.6953,971,177.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="372.5" x2="973" y1="177.6953" y2="177.6953"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="379.5" y="172.6294">[03]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="413.5" y="172.6294">Штрихкод карты лояльности</text><line style="stroke:#A80036;stroke-width:1.0;" x1="979" x2="1021" y1="297.625" y2="297.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1021" x2="1021" y1="297.625" y2="310.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="980" x2="1021" y1="310.625" y2="310.625"/><polygon fill="#A80036" points="990,306.625,980,310.625,990,314.625,986,310.625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="986" y="247.1606">[04]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="1021" y="201.7622">- Сканирование товаров.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="364" x="1021" y="216.895">- Считывание из Кошелька номера карты лояльности.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="352" x="1021" y="232.0278">- Проверка доступности оплаты через Кошелёк Pay</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1025" y="247.1606">(в ШК содержится</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="78" x="1152" y="247.1606">cardSession</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="1230" y="247.1606">).</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="1021" y="262.2935">- Валидация парольной части.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="1021" y="277.4263">- Идентификация покупателя по</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="57" x="1246" y="277.4263">loyaltyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1303" y="277.4263">.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="1021" y="292.5591">- Расчет суммы.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="979" x2="1021" y1="339.7578" y2="339.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1021" x2="1021" y1="339.7578" y2="352.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="980" x2="1021" y1="352.7578" y2="352.7578"/><polygon fill="#A80036" points="990,348.7578,980,352.7578,990,356.7578,986,352.7578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="986" y="334.6919">[05]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="1021" y="334.6919">Кассир выполняет закрытие чека на кассе</text><path d="M409.5,367.7578 L475.5,367.7578 L475.5,374.7578 L465.5,384.7578 L409.5,384.7578 L409.5,367.7578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="381.3359" style="stroke:#000000;stroke-width:2.0;" width="822.5" x="409.5" y="367.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="424.5" y="380.8247">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="101" x="490.5" y="379.9683">[ШК содержит</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="76" x="595.5" y="379.9683">cardSession</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="671.5" y="379.9683">]</text><polygon fill="#A80036" points="521,417.1563,511,421.1563,521,425.1563,517,421.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="515" x2="978" y1="421.1563" y2="421.1563"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="527" y="408.5239">[06]</text><text fill="#000000" filter="url(#b3e7ztk4aag0g0)" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="145" x="562" y="400.9575">[Кошелёк Pay API]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="711" y="400.9575"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="711" y="400.9575">POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="756" y="400.9575">/availability-info/task</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="562" y="416.0903">Запрос списка возможных провайдеров платежей</text><path d="M419.5,436.1563 L485.5,436.1563 L485.5,443.1563 L475.5,453.1563 L419.5,453.1563 L419.5,436.1563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="194.7344" style="stroke:#000000;stroke-width:2.0;" width="651.5" x="419.5" y="436.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="434.5" y="449.2231">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="176" x="500.5" y="448.3667">[HTTP Status Code = 200]</text><polygon fill="#A80036" points="967,470.4219,977,474.4219,967,478.4219,971,474.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="510" x2="973" y1="474.4219" y2="474.4219"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="517" y="469.356">[07]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="552" y="469.356">Список провайдеров платежей</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="419.5" x2="1071" y1="483.4219" y2="483.4219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="175" x="424.5" y="493.6323">[HTTP Status Code = 201]</text><polygon fill="#A80036" points="967,514.3594,977,518.3594,967,522.3594,971,518.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="510" x2="973" y1="518.3594" y2="518.3594"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="517" y="513.2935">[08]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="169" x="552" y="513.2935">availabilityInfoId, timeout</text><path d="M429.5,533.3594 L507.5,533.3594 L507.5,540.3594 L497.5,550.3594 L429.5,550.3594 L429.5,533.3594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="90.5313" style="stroke:#000000;stroke-width:2.0;" width="631.5" x="429.5" y="533.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="444.5" y="546.4263">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="451" x="522.5" y="545.5698">[Запрос списка провайдеров платежей до получения результата]</text><polygon fill="#A80036" points="521,582.7578,511,586.7578,521,590.7578,517,586.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="515" x2="978" y1="586.7578" y2="586.7578"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="527" y="574.1255">[09]</text><text fill="#000000" filter="url(#b3e7ztk4aag0g0)" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="145" x="562" y="566.5591">[Кошелёк Pay API]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="711" y="566.5591"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="711" y="566.5591">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="746" y="566.5591">/availability-info/{availabilityInfoId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="364" x="562" y="581.6919">Получение списка доступных провайдеров платежей</text><polygon fill="#A80036" points="967,611.8906,977,615.8906,967,619.8906,971,615.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="510" x2="973" y1="615.8906" y2="615.8906"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="517" y="610.8247">[10]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="552" y="610.8247">Список провайдеров платежей</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="409.5" x2="1232" y1="638.8906" y2="638.8906"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="121" x="414.5" y="649.1011">[ШК не содержит</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="76" x="539.5" y="649.1011">cardSession</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="615.5" y="649.1011">]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="979" x2="1021" y1="688.9609" y2="688.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1021" x2="1021" y1="688.9609" y2="701.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="980" x2="1021" y1="701.9609" y2="701.9609"/><polygon fill="#A80036" points="990,697.9609,980,701.9609,990,705.9609,986,701.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="986" y="676.3286">[11]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="1020" y="668.7622">Оплата "Кошелёк Pay"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="1020" y="683.895">не подключена у покупателя</text><path d="M796,714.9609 L796,739.9609 L1157,739.9609 L1157,724.9609 L1147,714.9609 L796,714.9609 " fill="#FBFB77" filter="url(#f3e7ztk4aag0g)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1147,714.9609 L1147,724.9609 L1157,724.9609 L1147,714.9609 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="802" y="732.0278">Стандартный сценарий оплаты (карта, наличные)</text><path d="M897,763.0938 L969,763.0938 L969,770.0938 L959,780.0938 L897,780.0938 L897,763.0938 " fill="#FFD700" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="188.9297" style="stroke:#000000;stroke-width:2.0;" width="341" x="897" y="763.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="912" y="776.1606">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="183" x="984" y="775.3042">[Расчет скидок и бонусов]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="979" x2="1021" y1="816.4922" y2="816.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1021" x2="1021" y1="816.4922" y2="829.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="980" x2="1021" y1="829.4922" y2="829.4922"/><polygon fill="#A80036" points="990,825.4922,980,829.4922,990,833.4922,986,829.4922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="986" y="803.8599">[12]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="1020" y="796.2935">Обращение к ЦОД ТСП</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="1020" y="811.4263">для расчета скидок и бонусов</text><line style="stroke:#A80036;stroke-width:1.0;" x1="979" x2="1021" y1="873.7578" y2="873.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1021" x2="1021" y1="873.7578" y2="886.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="980" x2="1021" y1="886.7578" y2="886.7578"/><polygon fill="#A80036" points="990,882.7578,980,886.7578,990,890.7578,986,886.7578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="986" y="861.1255">[13]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="1019" y="853.5591">Получение скидок и</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="1019" y="868.6919">бонусов от ЦОД ТСП</text><line style="stroke:#A80036;stroke-width:1.0;" x1="979" x2="1021" y1="931.0234" y2="931.0234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1021" x2="1021" y1="931.0234" y2="944.0234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="980" x2="1021" y1="944.0234" y2="944.0234"/><polygon fill="#A80036" points="990,940.0234,980,944.0234,990,948.0234,986,944.0234" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="986" y="918.3911">[14]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="1020" y="910.8247">Формирование итоговой</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="1020" y="925.9575">суммы платежа</text><!--MD5=[dfcde770e832ac97f0ce3f184bb48e5b]
@startuml
autonumber "<font color=red><b>[00]"
actor Пользователь as User
box Кошелёк #plum
	participant "Приложение\nКошелёк" as Wallet
	participant "Сервер\nКошелёк Pay API" as CMPAY 
end box
box Партнёр #lightblue 
	participant "Касса и ЦОД ТСП" as POS
end box

User->POS: Выкладка товаров к покупке
User->Wallet: Выбор карты лояльности в Кошельке
Wallet->POS: Штрихкод карты лояльности
POS->POS: - Сканирование товаров.\n- Считывание из Кошелька номера карты лояльности. \n- Проверка доступности оплаты через Кошелёк Pay\n (в ШК содержится //cardSession//). \n- Валидация парольной части. \n- Идентификация покупателя по //loyaltyId//.\n- Расчет суммы.  

POS->POS: Кассир выполняет закрытие чека на кассе
alt ШК содержит //cardSession//
POS->CMPAY: <back:gold>**[Кошелёк Pay API]**</back> **POST** /availability-info/task\nЗапрос списка возможных провайдеров платежей
alt HTTP Status Code = 200
 CMPAY- ->POS: Список провайдеров платежей
else HTTP Status Code = 201
CMPAY- ->POS: //availabilityInfoId, timeout//
loop Запрос списка провайдеров платежей до получения результата
POS->CMPAY: <back:gold>**[Кошелёк Pay API]**</back> **GET** /availability-info/{availabilityInfoId}\nПолучение списка доступных провайдеров платежей
CMPAY- ->POS: Список провайдеров платежей
end loop

end
else ШК не содержит //cardSession//
POS->POS: Оплата "Кошелёк Pay"\nне подключена у покупателя
note over POS
Стандартный сценарий оплаты (карта, наличные)
end note
end

opt#Gold #LightBlue Расчет скидок и бонусов
POS->POS: Обращение к ЦОД ТСП\nдля расчета скидок и бонусов 
POS->POS: Получение скидок и\nбонусов от ЦОД ТСП
POS->POS: Формирование итоговой\nсуммы платежа
end
@enduml

PlantUML version 1.2021.14beta6(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>